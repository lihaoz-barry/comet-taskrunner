# Desktop Status Overlay System

## æ¦‚è¿°

æ¡Œé¢çŠ¶æ€ Overlay ç³»ç»Ÿåœ¨è‡ªåŠ¨åŒ–ä»»åŠ¡è¿è¡Œæ—¶ï¼Œåœ¨å±å¹•è§’è½æ˜¾ç¤ºå®æ—¶çŠ¶æ€æŒ‡ç¤ºå™¨ï¼Œæé†’ç”¨æˆ·å±å¹•æ­£åœ¨è¢«è‡ªåŠ¨æ§åˆ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. Tkinter Overlay çª—å£
- **Always-on-top**: å§‹ç»ˆæ˜¾ç¤ºåœ¨æ‰€æœ‰çª—å£ä¹‹ä¸Š
- **åŠé€æ˜èƒŒæ™¯**: æ·±è‰²ä¸»é¢˜ï¼Œé€æ˜åº¦ 85%
- **æ— è¾¹æ¡†**: ä½¿ç”¨ `overrideredirect(True)` å®ç°
- **ä¸æ˜¾ç¤ºåœ¨ä»»åŠ¡æ **: Windows ä¸Šä½¿ç”¨ `-toolwindow` å±æ€§

### 2. æ˜¾ç¤ºå†…å®¹
- ğŸ¤– æ ‡é¢˜: "COMET AUTOMATION"
- âš¡ è­¦å‘Šæ–‡å­—: "å±å¹•æ­£åœ¨è¢«è‡ªåŠ¨æ§åˆ¶"
- ğŸ“ å½“å‰æ­¥éª¤: "Step X/7"
- æ­£åœ¨æ‰§è¡Œ: å½“å‰æ“ä½œæè¿°
- ä¸‹ä¸€æ­¥: ä¸‹ä¸€ä¸ªæ“ä½œæè¿°
- â±ï¸ å·²è¿è¡Œæ—¶é—´
- è¿›åº¦æ¡: å¯è§†åŒ–è¿›åº¦ç™¾åˆ†æ¯”

### 3. ä½ç½®é…ç½®
æ”¯æŒå››ä¸ªä½ç½®é€‰é¡¹ï¼š
- `TOP_RIGHT` (é»˜è®¤) - å³ä¸Šè§’
- `TOP_LEFT` - å·¦ä¸Šè§’
- `BOTTOM_RIGHT` - å³ä¸‹è§’
- `BOTTOM_LEFT` - å·¦ä¸‹è§’

é…ç½®ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `config/overlay_config.json`

### 4. ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡
ä½¿ç”¨ `pystray` å®ç°ï¼ˆå¯é€‰ï¼Œéœ€è¦ GTK æ”¯æŒï¼‰ï¼š
- æ˜¾ç¤ºåº”ç”¨å›¾æ ‡åœ¨ç³»ç»Ÿæ‰˜ç›˜
- å³é”®èœå•åŠŸèƒ½ï¼š
  - æ˜¾ç¤º/éšè— Overlay
  - Overlay ä½ç½®è®¾ç½®ï¼ˆå·¦ä¸Š/å³ä¸Š/å·¦ä¸‹/å³ä¸‹ï¼‰
  - å½“å‰ä»»åŠ¡çŠ¶æ€
  - é€€å‡º

### 5. é”®ç›˜ä¸­æ–­åŠŸèƒ½
- æŒ‰ **ESC** é”®å¯ä»¥ä¸­æ­¢å½“å‰è‡ªåŠ¨åŒ–ä»»åŠ¡
- éœ€è¦ `keyboard` æ¨¡å—æ”¯æŒ
- åœ¨æŸäº›ç¯å¢ƒä¸‹å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

Overlay ç³»ç»Ÿå·²è‡ªåŠ¨é›†æˆåˆ° `AITask` ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ï¼š

```python
from tasks import AITask

# åˆ›å»ºä»»åŠ¡ï¼ˆOverlay ä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼‰
task = AITask(instruction="ä½ çš„æŒ‡ä»¤")

# æ‰§è¡Œä»»åŠ¡ï¼ˆOverlay ä¼šè‡ªåŠ¨æ˜¾ç¤ºå’Œæ›´æ–°ï¼‰
task.execute(comet_path="path/to/comet.exe")
```

### æ‰‹åŠ¨æ§åˆ¶ Overlay

å¦‚æœéœ€è¦æ‰‹åŠ¨æ§åˆ¶ Overlayï¼š

```python
from overlay import StatusOverlay, OverlayConfig, OverlayPosition

# åˆ›å»ºé…ç½®
config = OverlayConfig()
config.set_position(OverlayPosition.TOP_LEFT)

# åˆ›å»º Overlay
overlay = StatusOverlay(config)

# è®¾ç½®å–æ¶ˆå›è°ƒ
def on_cancel():
    print("ä»»åŠ¡è¢«å–æ¶ˆ")
    overlay.close()

overlay.set_cancel_callback(on_cancel)

# æ˜¾ç¤º Overlay
overlay.show()

# æ›´æ–°çŠ¶æ€
overlay.update_status(
    current_step=3,
    total_steps=7,
    step_description="æŸ¥æ‰¾AssistantæŒ‰é’®",
    next_step_description="ç‚¹å‡»AssistantæŒ‰é’®"
)

# å…³é—­ Overlay
overlay.close()
```

### ä½¿ç”¨ç³»ç»Ÿæ‰˜ç›˜

```python
from overlay import StatusOverlay, SystemTray

overlay = StatusOverlay()
tray = SystemTray(overlay)

# å¯åŠ¨æ‰˜ç›˜
tray.start()

# æ˜¾ç¤º Overlay
overlay.show()

# ... æ‰§è¡Œä»»åŠ¡ ...

# æ¸…ç†
overlay.close()
tray.stop()
```

## æµ‹è¯•

### å¿«é€Ÿæ¼”ç¤º

```bash
python demo_overlay.py
```

è¿™ä¼šæ˜¾ç¤ºä¸€ä¸ªå®Œæ•´çš„ 7 æ­¥è‡ªåŠ¨åŒ–è¿‡ç¨‹æ¼”ç¤ºã€‚

### å®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
python test_overlay.py
```

é€‰æ‹©æµ‹è¯•é€‰é¡¹ï¼š
1. åŸºæœ¬ Overlay åŠŸèƒ½
2. æµ‹è¯•ä¸åŒä½ç½®
3. æµ‹è¯•ç³»ç»Ÿæ‰˜ç›˜
4. è¿è¡Œæ‰€æœ‰æµ‹è¯•

## é…ç½®æ–‡ä»¶

é…ç½®ä¿å­˜åœ¨ `config/overlay_config.json`:

```json
{
  "position": "top_right",
  "visible": true,
  "opacity": 0.85,
  "width": 300,
  "height": 280,
  "margin": 20
}
```

## ä¾èµ–é¡¹

æ ¸å¿ƒä¾èµ–ï¼š
- `tkinter` - Python å†…ç½®ï¼ˆéœ€è¦å®‰è£… python3-tkï¼‰

å¯é€‰ä¾èµ–ï¼š
- `pystray` - ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒï¼ˆéœ€è¦ GTKï¼‰
- `keyboard` - ESC é”®ç›‘å¬ï¼ˆå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- `Pillow` - å›¾åƒå¤„ç†ï¼ˆæ‰˜ç›˜å›¾æ ‡ï¼‰

## æ¶æ„

```
src/overlay/
â”œâ”€â”€ __init__.py              # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ overlay_config.py        # é…ç½®ç®¡ç†ï¼ˆä½ç½®ã€å¯è§æ€§ç­‰ï¼‰
â”œâ”€â”€ status_overlay.py        # Tkinter Overlay çª—å£å®ç°
â”œâ”€â”€ system_tray.py           # ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡å’Œèœå•
â””â”€â”€ keyboard_handler.py      # ESC é”®ç›‘å¬å’Œä»»åŠ¡å–æ¶ˆ
```

## çº¿ç¨‹å®‰å…¨

Overlay ç³»ç»Ÿä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹è¿è¡Œï¼Œç¡®ä¿ä¸ä¼šé˜»å¡ä¸»è‡ªåŠ¨åŒ–æµç¨‹ï¼š

- Overlay çª—å£åœ¨å•ç‹¬çº¿ç¨‹ä¸­è¿è¡Œ Tkinter ä¸»å¾ªç¯
- çŠ¶æ€æ›´æ–°ä½¿ç”¨çº¿ç¨‹é”ä¿æŠ¤
- æ—¶é—´æ›´æ–°æ¯ 100ms è‡ªåŠ¨åˆ·æ–°

## æ•…éšœæ’é™¤

### Overlay ä¸æ˜¾ç¤º

1. æ£€æŸ¥æ˜¯å¦å®‰è£…äº† `python3-tk`:
   ```bash
   sudo apt-get install python3-tk
   ```

2. æ£€æŸ¥æ˜¯å¦æœ‰æ˜¾ç¤ºæœåŠ¡å™¨ï¼ˆX11/Waylandï¼‰

### ç³»ç»Ÿæ‰˜ç›˜ä¸å·¥ä½œ

ç³»ç»Ÿæ‰˜ç›˜éœ€è¦ GTK æ”¯æŒï¼Œåœ¨æŸäº›ç¯å¢ƒä¸‹å¯èƒ½ä¸å¯ç”¨ï¼š
- Linux: éœ€è¦å®‰è£… GTK 3
- Windows: åº”è¯¥è‡ªåŠ¨å·¥ä½œ
- macOS: éœ€è¦é¢å¤–é…ç½®

### ESC é”®ä¸å·¥ä½œ

`keyboard` æ¨¡å—åœ¨æŸäº›ç¯å¢ƒä¸‹éœ€è¦ç®¡ç†å‘˜æƒé™ï¼š
- Windows: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
- Linux: ä½¿ç”¨ `sudo` æˆ–é…ç½® udev è§„åˆ™

## UI è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– COMET AUTOMATION       â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ âš¡ å±å¹•æ­£åœ¨è¢«è‡ªåŠ¨æ§åˆ¶      â”‚
â”‚                           â”‚
â”‚ ğŸ“ Step 5/7               â”‚
â”‚ æ­£åœ¨: è¾“å…¥æŒ‡ä»¤æ–‡å­—         â”‚
â”‚ ä¸‹ä¸€æ­¥: å‘é€æŒ‡ä»¤           â”‚
â”‚                           â”‚
â”‚ â±ï¸ å·²è¿è¡Œ: 12ç§’            â”‚
â”‚ [â– â– â– â– â– â–¡â–¡â–¡â–¡] 71%           â”‚
â”‚                           â”‚
â”‚ æŒ‰ ESC å–æ¶ˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…¼å®¹æ€§

- **Windows**: å®Œå…¨æ”¯æŒæ‰€æœ‰åŠŸèƒ½
- **Linux**: æ”¯æŒ Overlayï¼Œç³»ç»Ÿæ‰˜ç›˜éœ€è¦ GTK
- **macOS**: åº”è¯¥æ”¯æŒä½†æœªå……åˆ†æµ‹è¯•

## æ€§èƒ½

- Overlay æ›´æ–°é¢‘ç‡: 100ms
- å†…å­˜å ç”¨: ~10-20MB
- CPU å ç”¨: å¯å¿½ç•¥ä¸è®¡ï¼ˆ< 1%ï¼‰
